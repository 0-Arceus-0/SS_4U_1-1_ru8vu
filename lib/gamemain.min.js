function resize_canvas(){let _winW=window.innerWidth,_winH=window.innerHeight,wrp=document.getElementById("wrapper"),pre=document.getElementById("preload"),rob=document.getElementById("robot"),now_sc,set_sc=16/9,scale=_winW/_winH<=16/9?_winW/1280:_winH/720,_w=1280*scale+"px",_h=720*scale+"px",_o="translate(-50%,-50%) scale("+1.4*scale+")";wrp.style.width=pre.style.width=_w,wrp.style.height=pre.style.height=_h,rob&&(rob.style.transform=_o)}var mp3Ary,mp;function sound_Channel(id,bool,loop){if(bool){for(i=0;i<mp3Ary.length;i++)if(mp3Ary[i])try{mp3Ary[i].stop()}catch(e){console.log(e)}mp3Ary.length=0,mp3Ary=[]}if("stop"!=id){var mp3=createjs.Sound.play(id,{interrupt:createjs.Sound.INTERRUPT_EARLY,loop:loop});mp3Ary.push(mp3)}}function playSound(str){mus_bo&&sound_Channel(str,!1,0)}!function(q){window.onload=function(){var canvas,stage,exportRoot,root,res_path="res/";input_txt=document.getElementById("input_txt"),canvas=document.getElementById("canvas"),preload=document.getElementById("preload"),topic=document.getElementById("topic"),images=images||{};var manifest=[{src:"res/bg.png",id:"bg"},{src:"res/bg_ending.jpg",id:"bg_ending"},{src:"res/bg.mp3",id:"bg00"},{src:"res/allright.mp3",id:"allright"},{src:"res/button.mp3",id:"button"},{src:"res/don.mp3",id:"don"},{src:"res/finish.mp3",id:"finish"},{src:"res/next.mp3",id:"next"},{src:"res/right.mp3",id:"right"},{src:"res/wrong.mp3",id:"wrong"}];resize_canvas(),window.addEventListener("resize",resize_canvas),createjs.Sound.registerPlugins([createjs.HTMLAudioPlugin]),createjs.Sound.alternateExtensions=["ogg"];var loader=new createjs.LoadQueue(!1);function handleFileLoad(evt){"image"==evt.item.type&&(images[evt.item.id]=evt.result)}function handleComplete(){console.log(""),preload.style.display="none",topic.style.display="block",topic.addEventListener("click",initTopicFn),exportRoot=new lib.game,(stage=new createjs.Stage(canvas)).addChild(exportRoot),stage.update(),stage.enableMouseOver(),resize_canvas()}function initTopicFn(e){topic.style.display="none",topic.removeEventListener("click",initTopicFn),createjs.Ticker.framerate=10,createjs.Ticker.addEventListener("tick",stage),gameStart()}function gameStart(){(root=stage.children[0]).musBtn.addEventListener("click",function(){mus_bo=!mus_bo,mus_bo?createjs.Sound.muted=!1:createjs.Sound.muted=!0,root.musBtn.gotoAndStop(Number(mus_bo))}),mus_bo=!0,root.musBtn.cursor="pointer",root.musBtn.hitArea=root.musBtn.getChildAt(0),root.musBtn.gotoAndStop(1),root.edulogo.addEventListener("click",function(){window.open(" http://www.eduweb.idv.tw/ ","")}),sound_Channel("bg00",!1,-1),gameStage0()}function gameStage0(){function enterFn(){root.enterBtn.removeEventListener("click",enterFn),gameStage1()}root.gotoAndStop(0),root.enterBtn.addEventListener("click",enterFn)}function gameStage1(){var level=0,topIndex=0,allBtnAry=[],qusAry=[],ansAry=[],qusStatus=0,WAITSTATAS=0,WINSTATS=1,FINISHSTATS=2,annWait=!1;function clickFn(e){var mov=e.target;switch(mov){case root.qusBg.next_btn:case root.qusBg.next2_btn:switch(qusStatus){case WAITSTATAS:qusStatus="game",mov.visible=!1,root.qusBg.gotoAndPlay(1),setTimeout(function(){addAns()},300);break;case WINSTATS:qusStatus=WAITSTATAS,playSound("next"),level++,root.qusBg.gotoAndStop(0),removeAns(),newQus();break;case FINISHSTATS:qusStatus=WAITSTATAS,playSound("next"),removeBtn(root.qusBg.next_btn),removeBtn(root.qusBg.next2_btn),removeAns(),gameStage2()}}playSound("button"),root.failX.visible||annWait||ansAry.map(function(val){if(mov===val)if(annWait=!0,mov.i>=0){playSound("right"),mov.cursor="auto",mov.gotoAndStop(2),mov.removeEventListener("click",clickFn);var _x=root.qusMc["a"+mov.i].x+root.qusMc.x,_y=root.qusMc["a"+mov.i].y+root.qusMc.y;mov.i=-1,root.setChildIndex(mov,topIndex),createjs.Tween.get(mov).to({x:_x,y:_y},400).call(checkAll)}else playSound("wrong"),mov.gotoAndStop(3),root.failEff.visible=!0,root.failX.visible=!0,root.failEff.gotoAndPlay(0),root.failX.gotoAndPlay(0),setTimeout(function(){annWait=!1,mov.gotoAndStop(0),root.failEff.visible=!1,root.failX.visible=!1},1e3)})}function checkAll(){annWait=!1;var haveAnsNotReady=!1;ansAry.map(function(val){val.i>=0&&(haveAnsNotReady=!0)}),haveAnsNotReady||(playSound("allright"),removeBtn(),qusAry.shift(),root.qusBg.gotoAndPlay("winner"),ansAry.map(function(val){val.i||(val.visible=!1)}),0==qusAry.length?(qusStatus=FINISHSTATS,root.qusBg.next_btn.visible=!0):(qusStatus=WINSTATS,root.qusBg.next2_btn.visible=!0))}function overFn(e){var mov=e.currentTarget;mov.currentFrame>1||mov.gotoAndStop(1)}function outFn(e){var mov=e.currentTarget;mov.currentFrame>1||mov.gotoAndStop(0)}function removeBtn(e){allBtnAry.map(function(mov){mov.removeEventListener("click",clickFn),mov.removeEventListener("mouseover",overFn),mov.removeEventListener("mouseout",outFn)}),allBtnAry.length=0,e&&(e.removeEventListener("click",clickFn),e.removeEventListener("mouseover",overFn),e.removeEventListener("mouseout",outFn))}function setBtn(mov,bo){bo||allBtnAry.push(mov),mov.cursor="pointer",mov.gotoAndStop(0),mov.hitArea=mov.getChildAt(0),mov.addEventListener("click",clickFn),mov.addEventListener("mouseover",overFn),mov.addEventListener("mouseout",outFn)}function removeAns(){ansAry.map(function(mov){root.removeChild(mov)})}function addAns(){for(var i=0;i<8;i++){var mov=new lib.ansMc,ar=[];qusAry[0]&&(ar=ar.concat(qusAry[0].opt[i]),mov.x=15+i%4*317,mov.y=515+105*Math.floor(i/4),mov.txt.text=ar[0],mov.i=ar[1],mov.hitArea=mov.getChildAt(0),ansAry.push(mov),mov.gotoAndStop(0),setBtn(mov),root.addChild(mov),topIndex=root.getChildIndex(mov))}}function newQus(){root.qusMc.x=1300,createjs.Tween.get(root.qusMc).to({x:180},500,createjs.Ease.quadInOut);for(var i=0;i<=3;i++)root.qusMc["a"+i].gotoAndStop(0),root.qusMc["a"+i].visible=!0,root.qusMc["a"+i].txt.text="";root.qusMc.txt.text=qusAry[0].qus,root.qusBg.next_btn.visible=level<5,root.qusBg.next2_btn.visible=5==level,root.star["st"+(level+1)].gotoAndPlay(1)}function randomQus(){var ary=[];for((qusAry=[]).length=0,ary=ary.concat(q.question);qusAry.length<5;)qusAry.push(ary.splice(Math.floor(Math.random()*ary.length),1)[0]);qusAry.map(function(val,inx,arr){var ar=[],ary=[];for(ar=ar.concat(val.opt);ar.length>0;)ary.push(ar.splice(Math.floor(Math.random()*ar.length),1)[0]);val.opt=ary})}root.gotoAndStop(1),level=0,qusStatus=WAITSTATAS,playSound("next"),root.failEff.visible=!1,root.failX.visible=!1,root.qusBg.gotoAndStop(0),root.qusBg.next2_btn.visible=!1,setBtn(root.qusBg.next_btn,!0),setBtn(root.qusBg.next2_btn,!0);for(var i=1;i<=5;i++)root.star["st"+i].gotoAndStop(0);randomQus(),newQus()}function gameStage2(){function replayFn(){root.replayBtn.removeEventListener("click",replayFn),sound_Channel("bg00",!0,-1),gameStage1()}root.gotoAndStop(2),sound_Channel("finish",!0,0),root.replayBtn.addEventListener("click",replayFn)}loader.installPlugin(createjs.Sound),loader.addEventListener("fileload",handleFileLoad),loader.addEventListener("complete",handleComplete),loader.loadManifest(manifest)}}(JSON.parse(qq_str)),mus_bo=!0,mp3Ary=[];